#Next two lines are to include parent directory for testing
import sys
sys.path.append("..")
# Remove them normally

from libDhcp import *
import logging

def create_Discover(MAC):
    D=HDRItem()
    D.op=dictCOMMANDname2code("DHCP-Discovery")
    #D.xid=createTransactionId()
    D.xid="29104a2e"
    D.flags=FLAG_BROADCAST
    D.MAC="002128104a2e"
    dhcp_options=[]
    dhcp_options.append(encodeAVP('RealMessageType', 1))
    dhcp_options.append(encodeAVP('ParameterRequestList', '01020305060b0c0d0f1011122b363c438081828384858687'.decode("hex")))
    dhcp_options.append(encodeAVP('MaximumMessageSize', 1260))
    dhcp_options.append(encodeAVP('UUID/GUID', '0000000000303032313238313034413245'.decode("hex")))
    dhcp_options.append(encodeAVP('ClientSystemArchitecture', 0))
    dhcp_options.append(encodeAVP('ClientNetworkInterface', 66049))
    dhcp_options.append(encodeAVP('ClassIdentifier', 'PXEClient:Arch:00000:UNDI:002001'))
    D.msg=joinAVPs(dhcp_options)
    return createPacket(D)
     
if __name__ == "__main__":
    logging.basicConfig(level=logging.DEBUG)
    #logging.basicConfig(level=logging.INFO)
    LoadDictionary("../dictDHCP.xml")
    # This is DHCP-Discover message
    msg="0101060029104a2e0004800000000000000000000000000000000000002128104a2e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000063825363350101371801020305060b0c0d0f1011122b363c438081828384858687390204ec611100000000003030323132383130344132455d0200005e030102013c20505845436c69656e743a417263683a30303030303a554e44493a303032303031ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
    # Create DHCP-Discover with known MAC address
    newmsg=create_Discover("002128104a2e")
    print msg
    print newmsg
    

